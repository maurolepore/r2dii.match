<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to r2dii.match • r2dii.match</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to r2dii.match">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r2dii.match</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/r2dii.match.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/maurolepore">
    <span class="fa fa-gavel"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/2DegreesInvesting/r2dii.match">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to r2dii.match</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/2DegreesInvesting/r2dii.match/blob/master/vignettes/r2dii.match.Rmd"><code>vignettes/r2dii.match.Rmd</code></a></small>
      <div class="hidden name"><code>r2dii.match.Rmd</code></div>

    </div>

    
    
<p>The package r2dii.match helps you to match counterparties from a loanbook to companies in a physical-asset database. Each section below shows you how.</p>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>We use the package r2dii.match to access the most important functions you’ll learn about. We also use example datasets from the package r2dii.dataraw, and optional but convenient functions from the packages dplyr and readr.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(r2dii.match)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(r2dii.dataraw)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; Loading required package: r2dii.utils</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; </span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; </span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(readr)</span></code></pre></div>
</div>
<div id="format-input-data-loanbook-and-asset-level-data-ald" class="section level2">
<h2 class="hasAnchor">
<a href="#format-input-data-loanbook-and-asset-level-data-ald" class="anchor"></a>Format input data <a href="https://2degreesinvesting.github.io/r2dii.dataraw/reference/loanbook_description.html">loanbook</a> and <a href="https://2degreesinvesting.github.io/r2dii.dataraw/reference/ald_description.html">asset-level data (ald)</a>
</h2>
<p>We need two datasets: a “loanbook” and an “asset-level dataset” (ald). These should be formatted like: <a href="https://2degreesinvesting.github.io/r2dii.dataraw/reference/loanbook_demo.html"><code>loanbook_demo</code></a> and <a href="https://2degreesinvesting.github.io/r2dii.dataraw/reference/ald_demo.html"><code>ald_demo</code></a> (from the <a href="https://2degreesinvesting.github.io/r2dii.dataraw">r2dii.dataraw package</a>).</p>
<p>(A note on sector classification: Matches are preferred when the sector from the <code>loanbook</code> matches the sector from the <code>ald</code>. The <code>loanbook</code> sector is determined internally using the <code>sector_classification_system</code> and <code>sector_classification_direct_loantaker</code> columns. Currently, <code>sector_classification_system</code> must be either <code>ISIC</code> or <code>NACE</code>. If you would like to use a different classification system, please raise an issue in <a href="https://github.com/2DegreesInvesting/r2dii.dataraw">r2dii.dataraw</a> and we can incorporate it.)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>loanbook_demo</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#&gt; # A tibble: 320 x 19</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">#&gt;    id_loan id_direct_loant… name_direct_loa… id_intermediate… name_intermedia…</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;           </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">#&gt;  1 L1      C294             Yuamen Xinneng … &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt;  2 L2      C293             Yuamen Changyua… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt;  3 L3      C292             Yuama Ethanol L… IP5              Yuama Inc.      </span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt;  4 L4      C299             Yudaksel Holdin… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt;  5 L5      C305             Yukon Energy Co… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt;  6 L6      C304             Yukon Developme… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt;  7 L7      C227             Yaugoa-Zapadnay… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt;  8 L8      C303             Yueyang City Co… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;  9 L9      C301             Yuedxiu Corp One IP10             Yuedxiu Group   </span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; 10 L10     C302             Yuexi County AA… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; # … with 310 more rows, and 14 more variables: id_ultimate_parent &lt;chr&gt;,</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; #   name_ultimate_parent &lt;chr&gt;, loan_size_outstanding &lt;dbl&gt;,</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; #   loan_size_outstanding_currency &lt;chr&gt;, loan_size_credit_limit &lt;dbl&gt;,</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; #   loan_size_credit_limit_currency &lt;chr&gt;, sector_classification_system &lt;chr&gt;,</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; #   sector_classification_input_type &lt;chr&gt;,</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; #   sector_classification_direct_loantaker &lt;dbl&gt;, fi_type &lt;chr&gt;,</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt; #   flag_project_finance_loan &lt;chr&gt;, name_project &lt;lgl&gt;,</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt; #   lei_direct_loantaker &lt;lgl&gt;, isin_direct_loantaker &lt;lgl&gt;</span></span>
<span id="cb2-23"><a href="#cb2-23"></a></span>
<span id="cb2-24"><a href="#cb2-24"></a>ald_demo</span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt; # A tibble: 17,368 x 13</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt;    name_company sector technology production_unit  year production</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt;    &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">#&gt;  1 aba hydropo… power  hydrocap   MW               2013    133340.</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co">#&gt;  2 aba hydropo… power  hydrocap   MW               2014    131582.</span></span>
<span id="cb2-30"><a href="#cb2-30"></a><span class="co">#&gt;  3 aba hydropo… power  hydrocap   MW               2015    129824.</span></span>
<span id="cb2-31"><a href="#cb2-31"></a><span class="co">#&gt;  4 aba hydropo… power  hydrocap   MW               2016    128065.</span></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co">#&gt;  5 aba hydropo… power  hydrocap   MW               2017    126307.</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">#&gt;  6 aba hydropo… power  hydrocap   MW               2018    124549.</span></span>
<span id="cb2-34"><a href="#cb2-34"></a><span class="co">#&gt;  7 aba hydropo… power  hydrocap   MW               2019    122790.</span></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">#&gt;  8 aba hydropo… power  hydrocap   MW               2020    121032.</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">#&gt;  9 aba hydropo… power  hydrocap   MW               2021    119274.</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co">#&gt; 10 aba hydropo… power  hydrocap   MW               2022    117515.</span></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="co">#&gt; # … with 17,358 more rows, and 7 more variables: emission_factor &lt;dbl&gt;,</span></span>
<span id="cb2-39"><a href="#cb2-39"></a><span class="co">#&gt; #   country_of_domicile &lt;chr&gt;, plant_location &lt;chr&gt;, number_of_assets &lt;dbl&gt;,</span></span>
<span id="cb2-40"><a href="#cb2-40"></a><span class="co">#&gt; #   is_ultimate_owner &lt;lgl&gt;, is_ultimate_listed_owner &lt;lgl&gt;,</span></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">#&gt; #   ald_timestamp &lt;chr&gt;</span></span></code></pre></div>
<p>If you want to use <code>loanbook_demo</code> and <code>ald_demo</code> as template to create your own datasets, do this:</p>
<ul>
<li>Write <em>loanbook_demo.csv</em> and <em>ald_demo.csv</em> with:</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Writting to current working directory </span></span>
<span id="cb3-2"><a href="#cb3-2"></a>loanbook_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span><span class="kw"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span>(<span class="dt">path =</span> <span class="st">"loanbook_demo.csv"</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a>ald_demo <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="st">  </span><span class="kw"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span>(<span class="dt">path =</span> <span class="st">"ald_demo.csv"</span>)</span></code></pre></div>
<ul>
<li>For each dataset, replace our demo data with your data.</li>
<li>Save each dataset as, for example, <em>your_loanbook.csv</em> and <em>your_ald.csv</em>.</li>
<li>Read your datasets back into R with:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Reading from current working directory </span></span>
<span id="cb4-2"><a href="#cb4-2"></a>your_loanbook &lt;-<span class="st"> </span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="st">"your_loanbook.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>your_ald &lt;-<span class="st"> </span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="st">"your_ald.csv"</span>)</span></code></pre></div>
<p>Here we continue to use the <code>*_demo</code> datasets, pretending they contain the data of your own.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">: Skip this to avoid overwriting your data with our demo data</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>your_loanbook &lt;-<span class="st"> </span>loanbook_demo</span>
<span id="cb5-3"><a href="#cb5-3"></a>your_ald &lt;-<span class="st"> </span>ald_demo</span></code></pre></div>
</div>
<div id="score-the-goodness-of-the-match-between-the-loanbook-and-ald-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#score-the-goodness-of-the-match-between-the-loanbook-and-ald-datasets" class="anchor"></a>Score the goodness of the match between the loanbook and ald datasets</h2>
<p><code><a href="../reference/match_name.html">match_name()</a></code> scores the match between names in a loanbook dataset (lbk) and names in an asset-level dataset (ald). The names come from the columns <code>name_direct_loantaker</code>, <code>name_intermediate_parent_*</code> and <code>name_ultimate_parent</code> of the loanbook dataset, and from the column <code>name_company</code> of the a asset-level dataset. There can be any number of <code>name_intermediate_parent_*</code> columns, where <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> indicates the level up the corporate tree from <code>direct_loantaker</code>.</p>
<p>The raw names are internally transformed applying best-practices commonly used in name matching algorithms, such as:</p>
<ul>
<li>Remove special characters.</li>
<li>Replace language specific characters.</li>
<li>Abbreviate certain names to reduce their importance in the matching.</li>
<li>Removing corporate suffixes when necessary.</li>
<li>Spell out numbers to increase their importance.</li>
</ul>
<p>The similarity is then scored between the internally-transformed names of the loanbook against the ald. (For more information on the scoring algorithm used, see: <code><a href="https://rdrr.io/pkg/stringdist/man/stringsim.html">stringdist::stringsim()</a></code>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw"><a href="../reference/match_name.html">match_name</a></span>(your_loanbook, your_ald)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">#&gt; # A tibble: 502 x 27</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">#&gt;    id_loan id_direct_loant… name_direct_loa… id_intermediate… name_intermedia…</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;           </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt;  1 L170    C203             Tesla Inc        &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt;  2 L180    C217             Weichai Power C… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">#&gt;  3 L181    C218             Wheego           &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt;  4 L195    C313             Zhengzhou Yuton… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;  5 L174    C211             Tvr              &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;  6 L198    C317             Ziyang Nanjun    &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt;  7 L193    C310             Zamyad           &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt;  8 L165    C195             Sunwin Bus       &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt;  9 L154    C171             Shandong Tangju… &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; 10 L164    C193             Subaru Corp      &lt;NA&gt;             &lt;NA&gt;            </span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; # … with 492 more rows, and 22 more variables: id_ultimate_parent &lt;chr&gt;,</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; #   name_ultimate_parent &lt;chr&gt;, loan_size_outstanding &lt;dbl&gt;,</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt; #   loan_size_outstanding_currency &lt;chr&gt;, loan_size_credit_limit &lt;dbl&gt;,</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt; #   loan_size_credit_limit_currency &lt;chr&gt;, sector_classification_system &lt;chr&gt;,</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt; #   sector_classification_input_type &lt;chr&gt;,</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt; #   sector_classification_direct_loantaker &lt;dbl&gt;, fi_type &lt;chr&gt;,</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt; #   flag_project_finance_loan &lt;chr&gt;, name_project &lt;lgl&gt;,</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#&gt; #   lei_direct_loantaker &lt;lgl&gt;, isin_direct_loantaker &lt;lgl&gt;, id_2dii &lt;chr&gt;,</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt; #   level &lt;chr&gt;, sector &lt;chr&gt;, sector_ald &lt;chr&gt;, name &lt;chr&gt;, name_ald &lt;chr&gt;,</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">#&gt; #   score &lt;dbl&gt;, source &lt;chr&gt;</span></span></code></pre></div>
<p><code><a href="../reference/match_name.html">match_name()</a></code> defaults to scoring matches between name strings that belong to the same sector. Using <code>by_sector = FALSE</code> removes this limitation – increasing computation time, and the number of potentially incorrect matches to manually validate.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="../reference/match_name.html">match_name</a></span>(your_loanbook, your_ald, <span class="dt">by_sector =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>()</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="co">#&gt; [1] 673</span></span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co"># Compare</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="kw"><a href="../reference/match_name.html">match_name</a></span>(your_loanbook, your_ald, <span class="dt">by_sector =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>()</span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; [1] 502</span></span></code></pre></div>
<p><code>min_score</code> allows you to minimum threshold <code>score</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>matched &lt;-<span class="st"> </span><span class="kw"><a href="../reference/match_name.html">match_name</a></span>(your_loanbook, your_ald, <span class="dt">min_score =</span> <span class="fl">0.9</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(matched<span class="op">$</span>score)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt; [1] 0.9058824 1.0000000</span></span></code></pre></div>
<div id="maybe-overwrite-matches" class="section level3">
<h3 class="hasAnchor">
<a href="#maybe-overwrite-matches" class="anchor"></a>Maybe overwrite matches</h3>
<p>If you are happy with the matching coverage achieved, proceed to the next step. Otherwise, you can manually add matches, not found automatically by <code><a href="../reference/match_name.html">match_name()</a></code>. To do this, manually inspect the <code>ald</code> and find a company you would like to match to your loanbook. Once a match is found, use excel to write a .csv file similar to <a href="https://2degreesinvesting.github.io/r2dii.dataraw/reference/overwrite_demo.html"><code>overwrite_demo</code></a>, where:</p>
<ul>
<li>
<code>level</code> indicates the level that the manual match should be added to (e.g. <code>direct_loantaker</code>)</li>
<li>
<code>id_2dii</code> is the id of the loanbook company you would like to match (from the output of <code><a href="../reference/match_name.html">match_name()</a></code>)</li>
<li>
<code>name</code> is the ald company you would like to manually link to</li>
<li>
<code>sector</code> optionally you can also overwrite the sector.</li>
<li>
<code>source</code> this can be used later to determine where all manual matches came from.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>matched &lt;-<span class="st"> </span><span class="kw"><a href="../reference/match_name.html">match_name</a></span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>  your_loanbook, your_ald, <span class="dt">min_score =</span> <span class="fl">0.9</span>, <span class="dt">overwrite =</span> overwrite_demo</span>
<span id="cb9-3"><a href="#cb9-3"></a>)</span></code></pre></div>
</div>
</div>
<div id="validate-matches" class="section level2">
<h2 class="hasAnchor">
<a href="#validate-matches" class="anchor"></a>Validate matches</h2>
<p>Write the output of <code><a href="../reference/match_name.html">match_name()</a></code> into a .csv file with:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Writting to current working directory</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>matched <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">  </span>readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span>(<span class="st">"matched.csv"</span>)</span></code></pre></div>
<p>Compare, edit, and save the data manually:</p>
<ul>
<li>Open <em>matched.csv</em> with any spreadsheet editor (e.g. MS Excel, Google Sheets).</li>
<li>Compare the columns <code>name</code> and <code>name_ald</code> manually to determine if the match is valid. Other information can be used in conjunction with just the names to ensure the two entities match (sector, internal information on the company structure, etc.)</li>
<li>Edit the data:
<ul>
<li>If you are happy with the match, set the <code>score</code> value to <code>1</code>.</li>
<li>Otherwise set or leave the <code>score</code> value to anything other than <code>1</code>.</li>
</ul>
</li>
<li>Save the edited file as, say, <em>valid_matches.csv</em>.</li>
</ul>
<p>Re-read the edited file (validated) with:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Reading from current working directory</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>valid_matches &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="st">"valid_matches.csv"</span>)</span></code></pre></div>
</div>
<div id="prioritize-validated-matches-by-level" class="section level2">
<h2 class="hasAnchor">
<a href="#prioritize-validated-matches-by-level" class="anchor"></a>Prioritize validated matches by level</h2>
<p>The validated dataset may have multiple matches per loan. Consider the case where a loan is given to “Acme Power USA”, a subsidiary of “Acme Power Co.”. There may be both “Acme Power USA” and “Acme Power Co.” in the <code>ald</code>, and so there could be two valid matches for this loan. To get the best match only, use <code><a href="../reference/prioritize.html">prioritize()</a></code> – it picks rows where <code>score</code> is 2 and <code>level</code> per loan is of highest <code>priority()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Pretend we validated the matched dataset</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>valid_matches &lt;-<span class="st"> </span>matched</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a>some_interesting_columns &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(id_2dii, level, score)</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a>valid_matches <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="st">  </span><span class="kw"><a href="../reference/prioritize.html">prioritize</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">!!!</span><span class="st"> </span>some_interesting_columns)</span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt; # A tibble: 267 x 3</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt;    id_2dii level            score</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt;  1 DL167   direct_loantaker     1</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">#&gt;  2 DL168   direct_loantaker     1</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">#&gt;  3 DL169   direct_loantaker     1</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co">#&gt;  4 DL170   direct_loantaker     1</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">#&gt;  5 DL172   direct_loantaker     1</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co">#&gt;  6 DL175   direct_loantaker     1</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">#&gt;  7 DL177   direct_loantaker     1</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">#&gt;  8 DL179   direct_loantaker     1</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">#&gt;  9 DL181   direct_loantaker     1</span></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="co">#&gt; 10 DL183   direct_loantaker     1</span></span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">#&gt; # … with 257 more rows</span></span></code></pre></div>
<p>By default, highest priority refers to the most granular match (<code>direct_loantaker</code>). The default priority is set internally via <code>prioritize_levels()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw"><a href="../reference/prioritize_level.html">prioritize_level</a></span>(matched)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">#&gt; [1] "direct_loantaker"      "intermediate_parent_1" "ultimate_parent"</span></span></code></pre></div>
<p>You may use a different priority. One way to do that is to pass a function to <code>priority</code>. For example, use <code>rev</code> to reverse the default priority.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>matched <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw"><a href="../reference/prioritize.html">prioritize</a></span>(<span class="dt">priority =</span> rev) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">!!!</span><span class="st"> </span>some_interesting_columns)</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">#&gt; # A tibble: 267 x 3</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co">#&gt;    id_2dii level           score</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt;  1 UP23    ultimate_parent     1</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt;  2 UP25    ultimate_parent     1</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt;  3 UP36    ultimate_parent     1</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt;  4 UP52    ultimate_parent     1</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt;  5 UP53    ultimate_parent     1</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt;  6 UP58    ultimate_parent     1</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt;  7 UP79    ultimate_parent     1</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt;  8 UP80    ultimate_parent     1</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt;  9 UP89    ultimate_parent     1</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt; 10 UP94    ultimate_parent     1</span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">#&gt; # … with 257 more rows</span></span></code></pre></div>
</div>
<div id="next-analyze" class="section level2">
<h2 class="hasAnchor">
<a href="#next-analyze" class="anchor"></a>Next: Analyze</h2>
<p>Once you achieve enough matching coverage, you can analyze the output of <code><a href="../reference/prioritize.html">prioritize()</a></code> with the package <a href="https://github.com/2DegreesInvesting/r2dii.analysis">r2dii.analysis</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#format-input-data-loanbook-and-asset-level-data-ald">Format input data <span>loanbook</span> and <span>asset-level data (ald)</span></a></li>
      <li><a href="#score-the-goodness-of-the-match-between-the-loanbook-and-ald-datasets">Score the goodness of the match between the loanbook and ald datasets</a></li>
      <li><a href="#validate-matches">Validate matches</a></li>
      <li><a href="#prioritize-validated-matches-by-level">Prioritize validated matches by level</a></li>
      <li><a href="#next-analyze">Next: Analyze</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.linkedin.com/in/mauro-lepore/">Mauro Lepore</a>, Klaus Hagedorn, George Harris, Jackson Hoffart, Daan Koopman, Florence Palandri, Evgeny Petrovsky, <a href="https://2degrees-investing.org/">2 Degrees Investing Initiative</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
